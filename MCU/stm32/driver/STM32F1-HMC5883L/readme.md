# 基于STM32F1的电子罗盘HMC5883L角度测量

[参考](https://github.com/njuliuyang/2018-EducationalRobot-PosionModule)

## 1. HMC5883L模块

![](..\img\HMC5883L.png)

- 型号：GY-271
- 使用芯片：HMCL5883L
- 供电电源：3-5V
- 通信方式： [IIC通信协议](https://blog.csdn.net/zhanghuaichao/article/details/48266309) 
- 测试范围：± 1.3-8高斯
- `GY -273`5个引脚：`SCL串行时钟，SDA串行数据，Vcc_GND3.3V/5.0V兼容，DRDY感知数据更新：当测量完毕数据更新到寄存器后，DRDY引脚产生低电平脉冲。`

## 2. 工作原理

> 传统罗盘用一根被磁化的磁针来感应地球磁场，地球磁场与磁针之间的磁力时磁针转动，直至磁针的两端分别指向地球的磁南极与磁北极。电子罗盘也一样，只不过把磁针换成了**磁阻传感器**，然后将感受到的地磁信息转换为数字信号输出给用户使用。 

- 在制造过程中，将一个强磁场加在AMR上使其在某一方向上磁化，建立起一个主磁域，与主磁域垂直的轴被称为该AMR的敏感轴。

  ![](..\img\hmc1.png)

  ![](..\img\hmc2.png)

- 当有外界磁场Ha时，AMR上主磁域方向就会发生变化而不再是初始的方向了，那么磁场方向和电流的夹角θ也会发生变化，如图所示。对于AMR材料来说，θ角的变化会引起AMR自身阻值的变化。

  ![](..\img\hmc3.png)

- 利用惠更斯电桥检测AMR阻值的变化，如图7所示。R1/R2/R3/R4是初始状态相同的AMR电阻，但是R1/R2和R3/R4具有相反的磁化特性。当检测到外界磁场的时候，R1/R2阻值增加$\Delta R$；R而R3/R4减少$\Delta R$。这样在没有外界磁场的情况下，电桥的输出为零；而在有外界磁场时电桥的输出为一个微小的电压∆V。  

  ![](..\img\hmc4.png)

## 3. 基于HMC5883L角度测量

### 3.1 硬件连接

- `Vcc-GND:3.3V/5.0V兼容`
- `SCL:PB.6`
- `SDA:PB.7` 

### 3.2 软件设计

> 见工程文件

### 3.3 测试结果

**设置波特率为115200**

![](..\img\hmctest.png)

